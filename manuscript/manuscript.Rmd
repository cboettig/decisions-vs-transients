---
title: "Consequences of long transients in model inference and optimal control"
date: "`r Sys.Date()`"
author:
  - name: Carl Boettiger
    email: cboettig@berkeley.edu
    affiliation: ucb
    footnote: Corresponding Author
address:
  - code: ucb
    address: "ESPM Department, University of California, 130 Mulford Hall Berkeley, CA 94720-3114, USA"
abstract: |
  I explore the impact of long transient dynamics for model inference and optimal
journal: Theoretical ecology
layout: 5p
bibliography: refs.bib
output: rticles::elsevier_article

---

```{r include = FALSE}
knitr::opts_chunk$set(echo = FALSE, cache = 1,  
                      dev = "cairo_pdf", fig.width=4.5, 
                      fig.height=3.5, message = FALSE,
                      warning = FALSE)
library(hrbrthemes)
library(ggplot2)
library(ggthemes)
library(Cairo)
library(extrafont)
extrafont::loadfonts()
```

```{r message = FALSE}
library(tidyverse)   # plotting and data manipulation
```

```{r}
source("../R/ghost.R")
```


```{r}
data <- vroom::vroom("../data/reps.csv.xz") %>% filter(t < 3000)
## get tail cases for comparison
ex <- data %>% group_by(reps) %>% summarise(ave = mean(x)) %>% arrange(ave)
lows <- ex %>% dplyr::slice(1:10) %>% pull(reps)
highs <- ex %>% dplyr::slice((n()-9):n()) %>% pull(reps)
```



```{r arima_forecast}
library(stats)
x <- data %>% filter(reps == lows[[6]], t < 2000) %>% pull(x) %>% as.ts() 
fit <- arima(x)
y <- predict(fit, n.ahead = 1000) %>% as.data.frame()
y <- bind_rows(data.frame(pred = x, se = 0), y)
arima_forecast <- data %>% filter(reps == lows[[6]]) %>% select(t,x) %>% bind_cols(y)
```


```{r arima_figure, message=FALSE, warning=FALSE}
train <- arima_forecast %>% filter(t < 2000) 
test <- arima_forecast %>% filter(t > 2000) 
train %>%
  ggplot(aes(t)) + 
  geom_line(aes(y=x)) +
  geom_line(aes(y=pred), lwd = 1, lty = 3, col = "red", data = test) + 
  geom_ribbon(aes(y=pred, ymin=pred-se, ymax=pred+se), alpha = 0.4, fill = "red", data = test)  + 
  geom_line(aes(y=x), data = test, lty = 2, col="blue") +
  xlim(0,3000) + ylim(0, 1.6)+ ylab("x") + theme_minimal()


```




Transient dynamics have long been identified in the ecological systems @Hastings1994.   Ecological @Hastings2018


## Long transients when the underlying model is not known

One of the more intuitive implications of the existence of long transients is the inherent risk in mistaking them for stable state dynamics.  For example, Figure \ref{armina} illustrates how a transient 


### Stochastic dynamics and transients

Stochastic dynamics can weaken the average influence of a ghost attractor, but long transients are still likely.  Stochastic dynamics can also make weak attractors behave essentially as ghost attractors.  


# Methods

Stochastic dynamic programming solutions were computed in R [@R] using value iteration using the package `MDPToolbox` [@Marescot2013; @MDPtoolbox].  Code to reproduce this analysis is available at <https://github.com/cboettig/decisions-vs-transients>



\pagebreak 


# References